---
import Icon from "./Icon.astro";
import LinkButton from "./LinkButton.astro";
import { SITE } from "@/config";
---

{
  SITE.showBackButton && (
    <div class="mx-auto flex w-full max-w-app items-center justify-start px-2">
      <LinkButton
        id="back-button"
        href="/"
        class="focus-outline mt-8 mb-2 flex hover:text-foreground/75"
      >
        <Icon name="ChevronLeft" class="stroke-2 inline-block size-6 rtl:rotate-180" />
        <span>Go back</span>
      </LinkButton>
    </div>
  )
}

<script>
  /* Handle Go Back button click */
  function setupBackButton() {
    const backButton: HTMLAnchorElement | null =
      document.querySelector("#back-button");

    if (!backButton) return;

    const backUrl = sessionStorage.getItem("backUrl");

    // 更新 href
    if (backUrl) {
      backButton.href = backUrl;
    }

    // 拦截点击事件，标记需要恢复滚动位置
    backButton.addEventListener("click", () => {
      // 设置标记，让列表页恢复滚动位置
      sessionStorage.setItem("restoreScroll", "true");
      // 让默认的链接导航行为生效
    });
  }

  document.addEventListener("astro:page-load", setupBackButton);
  setupBackButton();
</script>
