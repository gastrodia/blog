---
import Icon from "./Icon.astro";
---

<button
  id="theme-btn"
  class="focus-outline relative size-6 hover:[&>svg]:text-accent"
  title="Toggles light & dark"
  aria-label="auto"
  aria-live="polite"
>
  <Icon name="Moon" class="size-full stroke-2 absolute top-[50%] left-[50%] -translate-[50%] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" />
  <Icon name="SunHigh" class="size-full stroke-2 absolute top-[50%] left-[50%] -translate-[50%] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" />
</button>

<script is:inline>
  // 使用事件委托，只需绑定一次
  // 防止重复绑定的标记
  if (!window.__themeToggleInitialized) {
    window.__themeToggleInitialized = true;
    
    document.addEventListener("click", (e) => {
      // 检查点击的是否是主题切换按钮或其子元素
      const themeBtn = e.target.closest("#theme-btn");
      
      if (themeBtn) {
        const currentTheme = document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      }
    });
  }
</script>

