---
import Icon from "./Icon.astro";
---

<button
  id="theme-btn"
  class="focus-outline relative size-6 hover:[&>svg]:text-accent"
  title="Toggles light & dark"
  aria-label="auto"
  aria-live="polite"
>
  <Icon name="Moon" class="size-full stroke-2 absolute top-[50%] left-[50%] -translate-[50%] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" />
  <Icon name="SunHigh" class="size-full stroke-2 absolute top-[50%] left-[50%] -translate-[50%] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" />
</button>

<script is:inline data-astro-rerun>
  function setupThemeToggle() {
    const themeBtn = document.getElementById("theme-btn");
    
    if (!themeBtn) return;

    themeBtn.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      
      document.documentElement.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
    });
  }

  // 首次加载时初始化
  setupThemeToggle();

  // View Transitions 页面切换后重新初始化
  document.addEventListener("astro:after-swap", setupThemeToggle);
</script>

