---
author: Code_You
pubDatetime: 2025-02-08T18:44
title: Bunå®ç°ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·
postSlug: p26
featured: true
draft: false
tags:
  - Bun
ogImage: ""
description: ğŸ¯Bunå¯çœŸå¥½ç”¨ï¼Œå‰è¿›å‰è¿›~
---

## æ€è€ƒ

åœ¨æˆ‘ä»¬ä½¿ç”¨æœ‰äº› npm åº“(cli)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸäº›æŒ‡ä»¤(å‘½ä»¤è¡Œæ¥å£)æ¥ä½¿ç”¨è¯¥åº“ã€‚ä¾‹å¦‚`rollup`çš„`rollup src/main.js -f cjs`ï¼›æˆ–`vite`çš„`vite dev`ã€‚

é‚£ä¹ˆä»–ä»¬æ—¶å¦‚ä½•å®ç°çš„ï¼Ÿ

å…³äº`node`æ˜¯å®ç°è¯¥åŠŸèƒ½ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ï¼Œå¤§å®¶å¯è‡ªè¡ŒæŸ¥é˜…ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨`bun`æ¥å®ç°è¯¥åŠŸèƒ½ã€‚å…¶å®ä¸ nodejs å®ç°åŸç†ä¸€è‡´ã€‚
æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„è¾“å…¥è¾“å‡ºå‘½ä»¤`printer`;

## åˆ›å»ºé¡¹ç›®

1. æ–°å»º`printer`æ–‡ä»¶å¤¹
2. ä½¿ç”¨`bun init`æ¥åˆå§‹åŒ–é¡¹ç›®ã€‚

## index.ts

```typescript
#!/usr/bin/env node

import { fileURLToPath } from "node:url";
import { dirname, join } from "node:path";
import { readFileSync } from "node:fs";

// è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// è¯»å– package.json
const packageJson = JSON.parse(
  readFileSync(join(__dirname, "package.json"), "utf-8")
);
const version: string = packageJson.version;

function evaluateMathExpression(expr: string): number {
  try {
    return new Function(`return ${expr}`)();
  } catch (error) {
    console.error("æ— æ•ˆçš„æ•°å­¦è¡¨è¾¾å¼");
    return NaN;
  }
}

function printHelp(): void {
  console.log(`
æ‰“å°å·¥å…· v${version}

ç”¨æ³•ï¼š
  printer <æ–‡æœ¬>          æ‰“å°æ–‡æœ¬
  printer --version      æ˜¾ç¤ºç‰ˆæœ¬å·
  printer --help         æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  printer --math <è¡¨è¾¾å¼> è®¡ç®—æ•°å­¦è¡¨è¾¾å¼

ç¤ºä¾‹ï¼š
  printer hello world
  printer --math 1+1
  `);
}

type StrategyFunction = (args: string[]) => void;

const strategies: { [key: string]: StrategyFunction } = {
  "--version": (): void => {
    console.log(version);
  },

  "--help": printHelp,

  "--math": (args: string[]): void => {
    if (args.length < 2) {
      console.error("è¯·æä¾›æ•°å­¦è¡¨è¾¾å¼");
      return;
    }
    const expression = args.slice(1).join("");
    const result = evaluateMathExpression(expression);
    if (!isNaN(result)) {
      console.log(result);
    }
  },

  default: (args: string[]): void => {
    console.log(args.join(" "));
  },
};

function printArgs(): void {
  const args: string[] = process.argv.slice(2);

  if (args.length === 0) {
    printHelp();
    return;
  }

  const strategy: StrategyFunction = strategies[args[0]] || strategies.default;
  strategy(args);
}

printArgs();
```

## ä¿®æ”¹ package.json

```json
{
  "name": "printer",
  "module": "dist/index.js",
  "version": "1.0.0",
  "type": "module",
  "devDependencies": {
    "@types/bun": "latest"
  },
  "scripts": {
    "start": "bun index.ts",
    "build": "bun build index.ts --target node --outdir dist && cp package.json dist"
  },
  "bin": {
    "printer": "./dist/index.js"
  },
  "peerDependencies": {
    "typescript": "^5.0.0"
  }
}
```

## æ‰“åŒ…

```bash
bun run build
```

## å®‰è£…åˆ°å½“å‰é¡¹ç›®

```bash
bun link
```

## å°±å¯ä»¥ä½¿ç”¨å•¦

```bash
printer hello
```

```text
hello
```

---

```bash
printer --math 1+1
```

```text
2
```

## å…¨å±€ä½¿ç”¨

```bash
npm install -g .
```

## ä¹Ÿå¯å‘å¸ƒåˆ° npm ä¸Šé¢

ç•¥
