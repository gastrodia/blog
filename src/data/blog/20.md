---
author: gastrodia
pubDatetime: 2023-05-27T20:23:00Z
title: React 服务式组件实现：基于 ReactDOM.createRoot 的 Loading 方案
slug: p20
featured: true
draft: false
tags:
  - React
ogImage: ""
description: 使用 React 18 的 createRoot API 实现函数式调用的 Loading 组件，支持多次调用计数管理，让全局状态管理更加优雅。
---

```typescript
import { Spin } from "antd";
import ReactDOM from "react-dom/client";
import type { SpinProps } from "antd";

class Loading {
  private container = document.createElement("div");
  private root = ReactDOM.createRoot(this.container);
  private count = 0;
  private readonly config: SpinProps | undefined;

  private setContainerStyle() {
    Object.assign(this.container.style, {
      position: "fixed",
      inset: "0",
      display: "flex",
      justifyContent: "center",
      alignItems: "center",
      backgroundColor: "rgba(255, 255, 255, .1)",
    });
  }

  constructor(config?: SpinProps) {
    this.config = config;
    this.setContainerStyle();
  }

  show(config?: SpinProps) {
    if (!this.count) {
      const props = config || this.config;
      this.root.render(<Spin {...props} />);
      document.body.appendChild(this.container);
    }
    this.count += 1;
  }

  hide() {
    this.count -= 1;
    if (this.count <= 0) {
      document.body.removeChild(this.container);
    }
  }
}

export default new Loading();
```

### Usage

```typescript
const handleLoading = () => {
  loading.show();
  setTimeout(() => {
    loading.hide();
  }, 1000);
};
```
