---
author: gastrodia
pubDatetime: 2025-02-08T18:44:00Z
title: ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªè·¨å¹³å°çš„â€œç«¯å£æ€æ‰‹â€å‘½ä»¤è¡Œå·¥å…·
slug: p26
featured: true
draft: false
tags:
  - Bun
ogImage: ""
description: ğŸ¯ç«¯å£è¢«å ç”¨æ˜¯å¼€å‘ä¸­å¸¸è§çš„é—®é¢˜ã€‚æœ¬æ•™ç¨‹å°†æ•™ä½ å¦‚ä½•åˆ©ç”¨ Bun çš„å¼ºå¤§åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•è€Œé«˜æ•ˆçš„å‘½ä»¤è¡Œå·¥å…·æ¥ä¸€é”®æŸ¥æ€ç«¯å£è¿›ç¨‹ã€‚æ–‡ç« åŒ…å«å®Œæ•´çš„è·¨å¹³å°ä»£ç å®ç°å’Œå‘å¸ƒæŒ‡å—ï¼Œæ˜¯ Bun å…¥é—¨å®æˆ˜çš„ç»ä½³é¡¹ç›®ã€‚
---

## æ€è€ƒ

åœ¨æˆ‘ä»¬ä½¿ç”¨æœ‰äº›npmåº“(cli)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸäº›æŒ‡ä»¤(å‘½ä»¤è¡Œæ¥å£)æ¥ä½¿ç”¨è¯¥åº“ã€‚ä¾‹å¦‚`rollup`çš„`rollup src/main.js -f cjs`ï¼›æˆ–`vite`çš„`vite dev`ã€‚

é‚£ä¹ˆä»–ä»¬æ—¶å¦‚ä½•å®ç°çš„ï¼Ÿ

å…³äº`node`æ˜¯å®ç°è¯¥åŠŸèƒ½ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ï¼Œå¤§å®¶å¯è‡ªè¡ŒæŸ¥é˜…ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨`bun`æ¥å®ç°è¯¥åŠŸèƒ½ã€‚å…¶å®ä¸nodejså®ç°åŸç†ä¸€è‡´ã€‚
æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„å…³é—­ç«¯å£å ç”¨çš„å·¥å…·;

## åˆ›å»ºé¡¹ç›®

1. æ–°å»º`kill-port-bun`æ–‡ä»¶å¤¹
2. ä½¿ç”¨`bun init`æ¥åˆå§‹åŒ–é¡¹ç›®ã€‚

## index.ts

````typescript file="index.ts"
#!/usr/bin/env bun
import packageJson from "./package.json";

const version = packageJson.version;

const platform = process.platform;

const exec: Partial<
  Record<
    typeof platform,
    (port: string | number, silent?: boolean) => Promise<void>
  >
> = {
  darwin: async (port: string | number, silent = false) => {
    const portStr = String(port);
    const result = await Bun.$`lsof -ti :${portStr}`.nothrow().quiet();

    // lsof returns non-zero exit code when no process is found
    if (result.exitCode !== 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    const pids = result
      .text()
      .trim()
      .split(/[\n\r]/)
      .filter(Boolean);
    if (pids.length === 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    for (const pid of pids) {
      if (!silent) console.log(`Killing process ${pid} on port ${portStr}`);
      const killResult = await Bun.$`kill -9 ${pid}`.nothrow().quiet();
      if (killResult.exitCode !== 0) {
        throw new Error(
          `Failed to kill process ${pid}: ${killResult.stderr.toString().trim()}`
        );
      }
    }
  },
  linux: async (port: string | number, silent = false) => {
    const portStr = String(port);
    const result = await Bun.$`lsof -ti :${portStr}`.nothrow().quiet();

    // lsof returns non-zero exit code when no process is found
    if (result.exitCode !== 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    const pids = result
      .text()
      .trim()
      .split(/[\n\r]/)
      .filter(Boolean);
    if (pids.length === 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    for (const pid of pids) {
      if (!silent) console.log(`Killing process ${pid} on port ${portStr}`);
      const killResult = await Bun.$`kill -9 ${pid}`.nothrow().quiet();
      if (killResult.exitCode !== 0) {
        throw new Error(
          `Failed to kill process ${pid}: ${killResult.stderr.toString().trim()}`
        );
      }
    }
  },
  win32: async (port: string | number, silent = false) => {
    const portStr = String(port);
    const result = await Bun.$`netstat -ano|findstr ${portStr}`
      .nothrow()
      .quiet();

    // findstr returns non-zero exit code when no match is found
    if (result.exitCode !== 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    const lines = result
      .text()
      .trim()
      .split(/[\n\r]/)
      .filter(Boolean);
    const pids = [...new Set(lines.map(line => line.match(/\d+$/)?.at(0)))];
    if (pids.length === 0) {
      if (!silent) console.log(`No process found using port ${portStr}`);
      return;
    }

    for (const pid of pids) {
      if (!silent) console.log(`Killing process ${pid} on port ${portStr}`);
      const killResult = await Bun.$`taskkill /pid ${pid} -t -f`
        .nothrow()
        .quiet();
      if (killResult.exitCode !== 0) {
        throw new Error(
          `Failed to kill process ${pid}: ${killResult.stderr.toString().trim()}`
        );
      }
    }
  },
  // TODO: Add support for other platforms
};

/**
 * Kill process(es) using the specified port
 * @param port - The port number to kill processes on
 * @param options - Optional configuration
 * @param options.silent - If true, suppresses console output (default: false)
 * @returns Promise that resolves when process(es) are killed
 * @throws Error if the platform is not supported
 *
 * @example
 * ```ts
 * import { kill } from 'kill-port-bun'
 *
 * // Kill process on port 3000
 * await kill(3000)
 *
 * // Kill process silently
 * await kill(8080, { silent: true })
 * ```
 */
export async function kill(
  port: string | number,
  options?: { silent?: boolean }
): Promise<void> {
  const silent = options?.silent ?? false;
  const run = exec[platform];
  if (!run) {
    throw new Error(`Unsupported platform: ${platform}`);
  }
  await run(port, silent);
}

// Legacy function name for backward compatibility
const portKill = async (port: string) => {
  await kill(port, { silent: false });
};

function logHelp(): void {
  console.log(`
  Port Killer v${version}
  
  Usage:
    kp <port>         Kill process using the port
    kp --version      Show version number
  
  Examples:
    kp 8080
    `);
}

function formatArgv() {
  const argv = Bun.argv.slice(2);
  if (argv.length === 0) {
    logHelp();
    return;
  }
  const arg = argv.at(0)?.trim();
  if (!arg) {
    logHelp();
    return;
  }
  if (arg === "--version") {
    console.log(`Port Killer v${version}`);
    return;
  }
  // If it's a number, treat it as a port
  if (!isNaN(Number(arg))) {
    portKill(arg);
    return;
  }
  console.error(`Invalid port: ${arg}`);
}

// Only run CLI logic if this file is the main entry point (not imported as a library)
if (import.meta.main) {
  formatArgv();
}
````

## ä¿®æ”¹package.json

```json
{
  "name": "kill-port-bun",
  "module": "index.ts",
  "version": "1.0.0",
  "type": "module",
  "devDependencies": {
    "@types/bun": "latest"
  },
  "scripts": {
    "start": "bun index.ts"
  },
  "bin": {
    "printer": "index.ts"
  },
  "peerDependencies": {
    "typescript": "^5.0.0"
  }
}
```

## å®‰è£…åˆ°å½“å‰é¡¹ç›®

```bash
bun install <PATH/kill-port-bun>
```

## å°±å¯ä»¥ä½¿ç”¨å•¦

**ä½œä¸º`CLI`ä½¿ç”¨**

```bash
bun run kp 3000
```

```text
Killing process 43040 on port 3000
```

**`BUN`é¡¹ç›®å†…ä½¿ç”¨**

```typescript
import { kill } from "kill-port-bun";

kill(3000);
```

## å…¨å±€ä½¿ç”¨

```bash
bun install -g .
```

## ä¹Ÿå¯å‘å¸ƒåˆ°npmä¸Šé¢

ç•¥
